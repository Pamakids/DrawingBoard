<?xml version="1.0" encoding="utf-8"?>
<s:Group xmlns:fx="http://ns.adobe.com/mxml/2009"
		 xmlns:s="library://ns.adobe.com/flex/spark" width="1024" height="768"
		 xmlns:mx="library://ns.adobe.com/flex/mx"
		 creationComplete="inited(event)">

	<fx:Script>
		<![CDATA[

			import com.greensock.TweenLite;
			import com.pamakids.models.ResultVO;

			import mx.collections.ArrayCollection;
			import mx.events.FlexEvent;

			import events.GalleryItemEvent;

			import models.PaintVO;
			import models.UserVO;

			protected function close_clickHandler(event:MouseEvent):void
			{
				dispatchEvent(new Event("galleryClose"));
			}



			[Bindable]
			private var paintsAC:ArrayCollection;

			protected function inited(event:FlexEvent):void
			{

				addEventListener(GalleryItemEvent.EVENT_ID, onItemClick);
//				paintsAC=new ArrayCollection();
				getTestArr();

//				var q:PaintQuery=new PaintQuery();
//				q.page=0;
//				API.instance.paintGet(refreshData, q);
			}

			private function getTestArr():void
			{
				var arr:Array=[];
				var arr2:Array=[];
				for (var i:int=0; i < 5; i++)
				{
					var po:PaintVO=new PaintVO();
					po.cover="http://cdn.ifanr.cn/wp-content/uploads/2014/04/DSCF1328.jpg";
					var uo:UserVO=new UserVO();
					uo.nickname="bobo";
					uo.email="123@abc.com";
					po.author=uo;

					if (i < 4)
					{
						arr2.push(po);
					}
					else
					{
						arr.push(arr2);
						arr.push(po);
					}
				}

				paintsAC=new ArrayCollection(arr);
			}

			private function refreshData(o:ResultVO):void
			{
				trace(o.results)
				var arr:Array=o.results as Array;

				if (arr.length > 1)
				{

				}
				else
				{

				}
			}

			protected function paints_mouseMoveHandler(event:MouseEvent):void
			{
				if (!paints.scroller.verticalScrollBar)
					return;
				var vScroll:Number=paints.scroller.verticalScrollBar.value;
				if (vScroll < -20)
				{
					trace(vScroll);
					if (!updateNew.visible)
					{
						updateNew.visible=true;
						updateNew.alpha=0;
						TweenLite.to(updateNew, 0.5, {alpha: 1});
					}
					updateNew.y=vScroll * -1 - 60;

					if (vScroll < -90)
					{
						updateNew.text='松开刷新';
					}
					else
					{
						updateNew.text='下拉刷新';
					}
				}
				else
				{
					updateNew.visible=false;
				}
			}

			protected function paints_mouseUpHandler(event:MouseEvent):void
			{
				if (!paints.scroller.verticalScrollBar)
					return;
				if (paints.scroller.verticalScrollBar.value < -90)
				{
					updateNew.visible=false;
					getTestArr();
//					getPaintsBefore();
				}
			}

			protected function onItemClick(event:GalleryItemEvent):void
			{
				trace(event.data)
			}

			protected function usercenter_clickHandler(event:MouseEvent):void
			{
				dispatchEvent(new Event("gallerytousercenter"));
			}

		]]>
	</fx:Script>

	<s:Image source="@Embed('assets/data/images/publicBg.png')"
			 mouseEnabled="false"/>

	<s:Image source="@Embed('assets/gallery/img/common/back.png')" left="42"
			 top="21" click="close_clickHandler(event)"/>

	<s:Image source="@Embed('assets/global/usercenterBtn.png')" right="42"
			 top="21" click="usercenter_clickHandler(event)"/>

	<s:Group clipAndEnableScrolling="true" top="133" bottom="0" width="100%">

		<s:List id="paints" dataProvider="{paintsAC}" top="0" bottom="0"
				itemRenderer="views.itemrenderers.PaintRenderer"
				mouseMove="paints_mouseMoveHandler(event)"
				mouseUp="paints_mouseUpHandler(event)" width="100%">
			<s:layout>
				<s:TileLayout requestedColumnCount="2" horizontalGap="18"
							  verticalGap="18" paddingTop="30"
							  paddingBottom="30" paddingLeft="30"
							  paddingRight="30"/>
			</s:layout>
		</s:List>

		<s:Label text="下拉刷新" id="updateNew" horizontalCenter="0" y="10"
				 visible="false"/>
		<s:Label text="上拉刷新" id="updateOlder" horizontalCenter="0" bottom="10"
				 visible="false"/>

	</s:Group>

</s:Group>
